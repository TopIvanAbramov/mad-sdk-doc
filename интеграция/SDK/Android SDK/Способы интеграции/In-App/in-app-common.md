---
label: Общая информация
order: 1
---

In App Message реклама — это всплывающие окна внутри приложения, где можно разместить изображение, кнопку с диплинком или копирование промокода. Такой формат помогает привлекать внимание пользователей и повышать конверсии прямо в интерфейсе приложения поверх любого экрана.


![|300x200](./inapp-preview.png){height="100"}



## 1. Инициализация загрузчика рекламы

Загрузчик рекламы `InAppAdLoader` позволяет предзагружать рекламу прежде, чем взаимодействие пользователя с приложением будет прервано показом рекламы.

Чтобы инициализировать загрузчик рекламы необходимо вызвать метод:
```kotlin
import ru.tander.mads.Mads

val loader = Mads.inAppAdLoader()
```

## 2. Загрузка рекламы

При загрузке рекламы необходимо передавать padId, который можно получить в рекламной админке либо от менеджера. Для отладки можно использовать тестовые padId. Смотрите подробнее в [Отладка интеграции](#6-отладка-интеграции)


```kotlin
import ru.tander.mads.inapp.loading.InAppAdRequest

val inAppAdRequest = InAppAdRequest(
    padId = 1,             // идентификатор места показа рекламы
    debugCreative = false, // true - если нужно загрузить отладочный рекламный креатив.
    targetings = emptyMap(), // параметры таргетингов.
)
```

Для старта загрузки рекламы необходимо вызвать метод `InAppAdLoader#load`:
```kotlin
loader.load(
    adRequest = inAppAdRequest,
    onSuccess = { inAppAd ->
        // реклама загружена
    },
    onFailure = { failure ->
        // произошла ошибка загрузки рекламы
    },
)
```

### Параметры:

| Название                | Тип               | Обязательный | Описание                                                                      |
|--------------------------|--------------------|:----:|----------------------------------------------------------------------------------|
| `padId`                  | `Int`              | ✅   | Id места размещения                    |
| `targetings`             | `[String: String]` | ✅   | Словарь таргетингов для персонализации рекламы          |
| `debugCreative` | `Bool`             | ❌   | Регулирует загрузку дебаг креативов (дефолтное значение: `false`). |

---

Один `InAppAdLoader` может параллельно загружать несколько рекламных объявлений.

Для отмены всех загрузок, запущенных одним и тем же `InAppAdLoader`, достаточно вызвать метод `InAppAdLoader#clear`:

```kotlin
loader.clear()
```

После вызова `InAppAdLoader#clear` загрузчик можно использовать повторно, если это необходимо.

## 3. Таргетирование рекламы

Таргетинги — это дополнительная информация о пользователе и контексте показа, которую приложение передаёт в MadSDK вместе с запросом рекламы. Каждый таргетинг описывается парой «ключ–значение»: например, пол пользователя, возрастная группа, тип тарифа, экран или раздел приложения, категория отображаемого контента и т.п.

Эти параметры используются рекламной системой для более точного подбора объявлений: ad‑сервер сопоставляет присланные таргетинги с настройками рекламных кампаний и отбирает только те, которые подходят под указанные условия. Чем точнее и стабильнее передаваемые таргетинги, тем более релевантную рекламу получают пользователи и тем выше эффективность монетизации.

Необходимо передавать словарь таргетингов в метод загрузки рекламы `Mads#load`:

```kotlin
val targetings: Map<String, String> = mapOf(
    "gender" to "female"
)

val inAppAdRequest = InAppAdRequest(
    padId = 1,               
    targetings = targetings, // таргетинги
)


loader.load(
    adRequest = inAppAdRequest,
    onSuccess = { inAppAd ->
        // реклама загружена
    },
    onFailure = { failure ->
        // произошла ошибка загрузки рекламы
    },
)
```

## 4. Показ рекламы

Для показа загруженной рекламы необходимо вызвать метод `Mads#showInAppAd`, передав ему загруженное рекламное объявление в качестве аргумента:
```kotlin
import ru.tander.mads.Mads

Mads.showInAppAd(
    activity = this,
    ad = inAppAd, // объявление, загруженное на шаге 3
    tag = TODO("Произвольная строка, идентифицирующая место показа рекламы внутри приложения."),
    colors = InAppAdColors(), // цветовая схема рекламного объявления
)
```

### Параметры:

| Parameter        | Type              | Req. | Description                                                                                    |
|------------------|-------------------|:----:|------------------------------------------------------------------------------------------------|
| `activity`             | `Activity`         | ✅   | Текущая Activity приложения, внутри которой покажется всплывающее рекламное объявление                |
| `ad`             | `InAppAd`         | ✅   | Реклама, загруженная на шаге 3                |
| `tag` | `String`| ✅   | Уникальный тег с местом размещения. Нужен, чтобы при смене конфигурации приложения коллбеки не переставали работать. Похожий принцип используется в [Activity Result](https://developer.android.com/training/basics/intents/result )                       |
| `colors`       | `InAppAdColors` | ❌   | UI конфигурация для кастомизации рекламы (дефолтное значение: `.default`). |


## 5. Реакция на события с рекламой

Если интегрирующему приложению нужно следить за событиями показа рекламы - приложение может вызвать метод `Mads#subscribeToInAppAdShowingEvents`, передав ему в качестве аргумента соответствующий колбэк:
```kotlin
import ru.tander.mads.Mads
import ru.tander.mads.inapp.showing.events.InAppAdShowingEventsCallback

val inAppAdShowingEventsCallback = object : InAppAdShowingEventsCallback {

    // вызывается при показе объявления
    fun onAdShown() { ... }

    // вызывается при ошибке показа объявления
    fun onAdFailedToShow(failure: Throwable) { ... }

    // вызывается при скрытии объявления
    fun onAdDismissed() { ... }

    // вызывается при нажатии пользователем на кнопку, открывающую диплинк
    fun onAdDeeplinkButtonClicked(deeplink: String) { ... }

    // вызывается при нажатии пользователем на кнопку, копирующую промокод
    fun onAdCopyPromoCodeButtonClicked(promoCode: String) { ... }
}

val inAppAdShowingEventsSubscription = Mads.subscribeToInAppAdShowingEvents(
    tag = TODO("Произвольная строка, идентифицирующая место показа рекламы внутри приложения (см. шаг 4)."),
    callback = inAppAdShowingEventsCallback,
)
```

Для отмены подписки на событиям показа рекламы достаточно вызвать метод `InAppAdShowingEventsSubscription#cancel`:
```kotlin
inAppAdShowingEventsSubscription.cancel()
```


## 6. Отладка интеграции

Для отладки интеграции In-App рекламы можно использовать отладочный рекламный креатив:
```kotlin
import ru.tander.mads.inapp.loading.InAppAdRequest

val inAppAdRequest = InAppAdRequest(
    padId = 1,          // отладочный padId 
    debugCreative = true, // включаем загрузку тестового креатива
)
```

## Пример интеграции In-App рекламы

Пример интеграции In-App рекламы можно посмотреть в [репозитории на GitHub](https://github.com/magnit-tech/mads-android-sdk).
